import{F as U}from"./FairyLoading-BmbdhaJQ.js";import{A as E}from"./AlertMessages-JIZeSrfZ.js";import{_ as T,c as d,d as l,w as A,b as s,f as _,F as L,s as C,t as g,r as h,o as c,e as V,v as k,x as w,y as b}from"./index-FcHiHiKZ.js";var I={VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2",VITE_APP_API_NAME:"dollob_api",BASE_URL:"/Happiness-Breakfast-Day/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:f,VITE_APP_API_NAME:p}=I,S={data(){return{carts:{},total:"",finalTotal:"",isLoading:!1,form:{user:{name:"",email:"",tel:"",address:""},message:""}}},components:{FairyLoading:U,AlertMessages:E},methods:{add_cart(n,t=1,r){let i="",e="";const m=`加入購物車成功，新增${t}筆商品~~`;this.isLoading=!0,r==="new"?(i=`${f}/api/${p}/cart`,e="post"):(i=`${f}/api/${p}/cart/${r}`,e="put");const x={product_id:n,qty:t};this.axios[e](i,{data:x}).then(u=>{this.get_cart(),this.$refs.AlertMessages.show_toast(m)}).catch(u=>{this.$refs.AlertMessages.show_alert(u==null?void 0:u.response.data.message,1300,"error")}).finally(()=>{this.isLoading=!1,this.$refs.userProductModal.hide_Model()})},get_cart(){this.isLoading=!0;const n=`${f}/api/${p}/cart`;this.axios.get(n).then(t=>{const{carts:r,total:i,finalTotal:e}=t.data.data;this.carts=r,this.total=i,this.finalTotal=e}).catch(t=>{this.$refs.AlertMessages.show_alert(t==null?void 0:t.response.data.message,1300,"error")}).finally(()=>{this.isLoading=!1})},delete_cart(n=null){let t="",r="",i="";this.isLoading=!0,n===null?(i=confirm("是否清空購物車？"),t=`${f}/api/${p}/carts`,r="購物車已清空 ಥ_ಥ"):(i=confirm("是否刪除品項？"),t=`${f}/api/${p}/cart/${n}`,r="已從購物車刪除 ಥ_ಥ"),i&&this.axios.delete(t).then(e=>{this.get_cart(),this.$refs.AlertMessages.show_toast(r)}).catch(e=>{this.$refs.AlertMessages.show_alert(e==null?void 0:e.response.data.message,1300,"error")}).finally(()=>{this.isLoading=!1})},onSubmit(){const n=`${f}/api/${p}/order`;this.isLoading=!0,this.axios.post(n,{data:this.form}).then(t=>{this.get_cart(),this.$refs.form.resetForm(),this.form.message="",this.$refs.AlertMessages.show_toast("訂單已成交，謝謝~~"),this.$router.push("/home")}).catch(t=>{this.$refs.AlertMessages.show_alert(t==null?void 0:t.response.data.message,1300,"error")}).finally(()=>{this.isLoading=!1})}},mounted(){this.get_cart()}},B={class:"container"},$={class:"d-flex row"},q={class:"d-flex mt-4 justify-content-between"},D=s("div",null,[s("h2",{class:"text-primary"},"購物車")],-1),N={class:"table align-middle border-primary border-top border-start border-end mt-4"},F=s("thead",{class:"table-primary"},[s("tr",null,[s("th",{class:"text-start"},"品名"),s("th",{style:{width:"150px"}},"數量/單位"),s("th",{class:"text-end"},"單價"),s("th")])],-1),R={class:"text-start d-flex justify-content-around"},j={key:0,class:"text-success"},O=["src"],z={class:"input-group input-group-sm"},H={class:"input-group mb-3"},G=["onUpdate:modelValue","disabled","onBlur"],J={class:"input-group-text",id:"basic-addon2"},K={class:"text-end"},Q={key:0,class:"text-success"},W=["onClick"],X={key:0,class:"fas fa-spinner fa-pulse"},Y=s("td",{colspan:"3",class:"text-end"},"總計",-1),Z={class:"text-end"},ss={key:0},es=s("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),ts={class:"text-end text-success"},os={class:"my-5 mt-4 row justify-content-center"},as=s("h2",{class:"text-primary"},"訂購人資訊",-1),ls={class:"mb-3"},is=s("label",{for:"email",class:"form-label"},"Email",-1),ns={class:"mb-3"},rs=s("label",{for:"name",class:"form-label"},"收件人姓名",-1),ds={class:"mb-3"},cs=s("label",{for:"tel",class:"form-label"},"收件人電話",-1),ms={class:"mb-3"},us=s("label",{for:"address",class:"form-label"},"收件人地址",-1),_s={class:"mb-3"},hs=s("label",{for:"message",class:"form-label"},"留言",-1),fs={class:"text-end"};function ps(n,t,r,i,e,m){const x=h("fairy-loading"),u=h("VueLoading"),M=h("alert-messages"),y=h("v-field"),v=h("error-message"),P=h("v-form");return c(),d(L,null,[l(u,{active:e.isLoading},{default:A(()=>[l(x)]),_:1},8,["active"]),l(M,{ref:"AlertMessages"},null,512),s("div",B,[s("div",$,[s("div",q,[D,s("div",null,[e.carts.length?(c(),d("button",{key:0,class:"btn btn-outline-danger",type:"button",onClick:t[0]||(t[0]=o=>m.delete_cart())},"清空購物車")):_("",!0)])]),s("table",N,[F,s("tbody",null,[e.carts?(c(!0),d(L,{key:0},C(e.carts,o=>(c(),d("tr",{key:o.id},[s("td",R,[V(g(o.product.title)+" ",1),o.coupon?(c(),d("div",j," 已套用優惠券 ")):_("",!0),s("img",{class:"img-fluid",src:o.product.imageUrl,alt:"",width:"150",height:"150"},null,8,O)]),s("td",null,[s("div",z,[s("div",H,[k(s("input",{min:"1",type:"number",class:"form-control","onUpdate:modelValue":a=>o.qty=a,disabled:e.isLoading,onBlur:a=>m.add_cart(o.product_id,o.qty,o.id)},null,40,G),[[w,o.qty,void 0,{number:!0}]]),s("span",J,g(o.product.unit),1)])])]),s("td",K,[o.coupon?(c(),d("small",Q,"折扣價：")):_("",!0),V(" "+g(o.product.price),1)]),s("td",null,[s("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:a=>m.delete_cart(o.id)},[e.isLoading?(c(),d("i",X)):_("",!0),V(" x ")],8,W)])]))),128)):_("",!0)]),s("tfoot",null,[s("tr",null,[Y,s("td",Z,g(e.total),1)]),e.carts.total!==e.carts.finalTotal?(c(),d("tr",ss,[es,s("td",ts,g(e.finalTotal),1)])):_("",!0)])])]),s("div",os,[as,l(P,{ref:"form",class:"col-md-6 mt-4",onSubmit:m.onSubmit},{default:A(({errors:o})=>[s("div",ls,[is,l(y,{id:"email",name:"email",type:"email",class:b(["form-control border-primary",{"is-invalid":o.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:e.form.user.email,"onUpdate:modelValue":t[1]||(t[1]=a=>e.form.user.email=a)},null,8,["class","modelValue"]),l(v,{name:"email",class:"invalid-feedback"})]),s("div",ns,[rs,l(y,{id:"name",name:"name",type:"text",class:b(["form-control border-primary",{"is-invalid":o.name}]),placeholder:"請輸入姓名",rules:"required",modelValue:e.form.user.name,"onUpdate:modelValue":t[2]||(t[2]=a=>e.form.user.name=a)},null,8,["class","modelValue"]),l(v,{name:"name",class:"invalid-feedback"})]),s("div",ds,[cs,l(y,{id:"tel",name:"tel",type:"tel",class:b(["form-control border-primary",{"is-invalid":o.tel}]),placeholder:"請輸入電話",rules:"required|minMaxLength:8,10",modelValue:e.form.user.tel,"onUpdate:modelValue":t[3]||(t[3]=a=>e.form.user.tel=a)},null,8,["class","modelValue"]),l(v,{name:"tel",class:"invalid-feedback"})]),s("div",ms,[us,l(y,{id:"address",name:"address",type:"text",class:b(["form-control border-primary",{"is-invalid":o.address}]),placeholder:"請輸入地址",rules:"required",modelValue:e.form.user.address,"onUpdate:modelValue":t[4]||(t[4]=a=>e.form.user.address=a)},null,8,["class","modelValue"]),l(v,{name:"address",class:"invalid-feedback"})]),s("div",_s,[hs,k(s("textarea",{id:"message",class:"form-control border-primary",cols:"30",rows:"10","onUpdate:modelValue":t[5]||(t[5]=a=>e.form.message=a)},null,512),[[w,e.form.message]])]),s("div",fs,[s("button",{type:"submit",class:b(["btn btn-primary",{disabled:Object.keys(o).length!==0||!e.carts.length}])},"送出訂單",2)])]),_:1},8,["onSubmit"])])])],64)}const vs=T(S,[["render",ps]]);export{vs as default};
