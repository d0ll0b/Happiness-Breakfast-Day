import{A as k}from"./AlertMessages-DNcVSF8R.js";import{M as E}from"./modal-z2eD4VzM.js";import{_ as A,o as i,c as r,a as t,b as h,t as l,f as $,F as u,j as w,u as x,H as v,r as _,w as C,d as V}from"./index-BGtsc3lz.js";import{D as I,P as S}from"./PaginationBtn-BRjO0E76.js";import{F as N}from"./FairyLoading-D2FY1WSv.js";var T={VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2",VITE_APP_API_NAME:"dollob_api",BASE_URL:"/Happiness-Breakfast-Day/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:b,VITE_APP_API_NAME:O}=T,R={props:["Order"],data(){return{Orders:[],tempOrder:{},isNew:!1,title:"",OrdersModal:"",isLoading:!1}},components:{AlertMessages:k},mounted(){this.OrdersModal=new E(this.$refs.OrderModal,{keyboard:!1});const o=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.axios.defaults.headers.common.Authorization=o,this.tempOrder={...this.Order}},methods:{getData(){this.$emit("get_data")},show_Modal(o,a){switch(o){case"new":this.isNew=!0,this.tempOrder={imagesUrl:[]},this.OrdersModal.show();break;case"edit":this.isNew=!1,this.tempOrder={...a},this.OrdersModal.show();break}},Update_Order(o){let a="";this.isNew===!0?(a=`${b}/api/${O}/admin/Order`,this.axios.post(a,{data:this.tempOrder}).then(e=>{this.$refs.AlertMessages.show_toast("新增產品成功!!!"),this.getData(),this.OrdersModal.hide()}).catch(e=>{this.$refs.AlertMessages.show_alert(e==null?void 0:e.response.data.message,1300,"error")})):(a=`${b}/api/${O}/admin/Order/${o}`,this.axios.put(a,{data:this.tempOrder}).then(e=>{this.$refs.AlertMessages.show_toast("更新產品成功!!!"),this.getData(),this.OrdersModal.hide()}).catch(e=>{this.$refs.AlertMessages.show_alert(e==null?void 0:e.response.data.message,1300,"error")}))},ShowImagebtn(o){return!Object.prototype.hasOwnProperty.call(o,"imagesUrl")&&!Array.isArray(o.imagesUrl)&&(o.imagesUrl=[],o.imagesUrl.push("")),!0},UploadImg(){let o="";o=`${b}/api/${O}/admin/upload`,this.isLoading=!0;const a=new FormData;a.append("file-to-upload",this.$refs.fileinput.files[0]),this.axios.post(o,a,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{this.tempOrder.imageUrl===""||this.tempOrder.imageUrl===void 0?this.tempOrder.imageUrl=e.data.imageUrl:this.tempOrder.imagesUrl[this.tempOrder.imagesUrl.length-1]===""?this.tempOrder.imagesUrl[this.tempOrder.imagesUrl.length-1]=e.data.imageUrl:this.tempOrder.imagesUrl.push(e.data.imageUrl),this.$refs.fileinput.value="",this.$refs.AlertMessages.show_toast("圖片上傳成功!!!")}).catch(e=>{this.$refs.AlertMessages.show_alert(e==null?void 0:e.response.data.message,1300,"error")}).finally(()=>{this.isLoading=!1})}}},B={id:"OrderModal",ref:"OrderModal",class:"modal fade text-start",tabindex:"-1","aria-labelledby":"OrderModalLabel","aria-hidden":"true"},F={class:"modal-dialog modal-xl"},j={class:"modal-content border-0"},H={class:"modal-header bg-dark text-white"},q=t("h5",{id:"OrderModalLabel",class:"modal-title"},[t("span",null,"訂單細節")],-1),G=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),z={class:"modal-body"},J={class:"row"},K={class:"col-sm-4"},Q=t("h2",null,"用戶資訊",-1),W={class:"table"},X={key:0},Y=t("th",null,"姓名",-1),Z=t("th",null,"Email",-1),tt=t("th",null,"電話",-1),et=t("th",null,"地址",-1),st={class:"col-sm-8"},ot=t("h2",null,"訂單細節",-1),at={class:"table"},lt=t("th",null,"訂單編號",-1),it=t("th",null,"下單時間",-1),rt=t("th",null,"付款時間",-1),nt={key:0},dt={key:1},ct=t("th",null,"付款狀態",-1),ht={key:0,class:"text-success"},_t={key:1,class:"text-muted"},pt=t("th",null,"金額",-1),ut=t("hr",null,null,-1),mt=t("h2",null,"訂購品項",-1),gt={class:"table"},ft={key:0},bt={class:"text-end"},Ot=t("hr",null,null,-1),yt={class:"d-flex justify-content-end"},Mt={class:"form-check form-switch"},$t={class:"form-check-label",for:"flexSwitchCheck"},wt={key:0,class:"text-success"},kt={key:1},At={class:"modal-footer"},xt=t("button",{type:"button",class:"btn btn-outline-danger","data-bs-dismiss":"modal"}," 取消 ",-1);function vt(o,a,e,m,s,p){const g=_("alert-messages");return i(),r("div",B,[t("div",F,[t("div",j,[t("div",H,[h(g,{ref:"AlertMessages"},null,512),q,G]),t("div",z,[t("div",J,[t("div",K,[Q,t("table",W,[s.tempOrder.user?(i(),r("tbody",X,[t("tr",null,[Y,t("td",null,l(s.tempOrder.user.name),1)]),t("tr",null,[Z,t("td",null,l(s.tempOrder.user.email),1)]),t("tr",null,[tt,t("td",null,l(s.tempOrder.user.tel),1)]),t("tr",null,[et,t("td",null,l(s.tempOrder.user.address),1)])])):$("",!0)])]),t("div",st,[ot,t("table",at,[t("tbody",null,[t("tr",null,[lt,t("td",null,l(s.tempOrder.id),1)]),t("tr",null,[it,t("td",null,l(new Date(s.tempOrder.create_at*1e3).toLocaleDateString()),1)]),t("tr",null,[rt,t("td",null,[s.tempOrder.paid_date?(i(),r("span",nt,l(new Date(s.tempOrder.paid_date*1e3).toLocaleDateString()),1)):(i(),r("span",dt,"無"))])]),t("tr",null,[ct,s.tempOrder.is_paid?(i(),r("td",ht,"完成付款")):(i(),r("td",_t,"尚未付款"))]),t("tr",null,[pt,t("td",null,l(s.tempOrder.total),1)])])]),ut,mt,t("table",gt,[s.tempOrder.products?(i(),r("tbody",ft,[(i(!0),r(u,null,w(s.tempOrder.products,(d,f)=>(i(),r("tr",{key:f},[t("td",null,l(d.product.title),1),t("td",null,l(d.qty)+"/"+l(d.product.unit),1),t("td",bt,l(d.final_total),1)]))),128))])):$("",!0)]),Ot,t("div",yt,[t("div",Mt,[x(t("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"flexSwitchCheck","onUpdate:modelValue":a[0]||(a[0]=d=>s.tempOrder.is_paid=d)},null,512),[[v,s.tempOrder.is_paid]]),t("label",$t,[s.tempOrder.is_paid?(i(),r("div",wt,"完成付款")):(i(),r("div",kt,"尚未付款"))])])])])])]),t("div",At,[xt,t("button",{type:"button",class:"btn btn-primary",onClick:a[1]||(a[1]=d=>p.Update_Order(s.tempOrder.id))}," 確認 ")])])])],512)}const Pt=A(R,[["render",vt]]);var Dt={VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2",VITE_APP_API_NAME:"dollob_api",BASE_URL:"/Happiness-Breakfast-Day/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:y,VITE_APP_API_NAME:M}=Dt,Ut={data(){return{orders:[],pagination:{},isLoading:!1}},components:{OrdersModal:Pt,DelModal:I,AlertMessages:k,PaginationBtn:S,FairyLoading:N},methods:{getOrders(o=1){this.isLoading=!0;const a=`${y}/api/${M}/admin/orders?page=${o}`;this.axios.get(a).then(e=>{const{orders:m,pagination:s}=e.data;this.orders=m,this.pagination=s}).catch(e=>{this.$refs.AlertMessages.show_alert(e==null?void 0:e.response.data.message,1300,"error")}).finally(()=>{this.isLoading=!1})},Delete_order(o){this.isLoading=!0;const a=`${y}/api/${M}/admin/order/${o}`;this.axios.delete(a).then(e=>{this.$refs.AlertMessages.show_toast("刪除訂單完成!!!"),this.getOrders(),this.$refs.DelModal.hide_Modal()}).catch(e=>{this.$refs.AlertMessages.show_alert(e==null?void 0:e.response.data.message,1300,"error")}).finally(()=>{this.isLoading=!1})},Paid_Stutas(o){this.isLoading=!0;const a=`${y}/api/${M}/admin/order/${o.id}`;this.axios.put(a,{data:o}).then(e=>{this.$refs.AlertMessages.show_toast("已修改付款狀態~~"),this.getOrders()}).catch(e=>{this.$refs.AlertMessages.show_alert(e==null?void 0:e.response.data.message,1300,"error")}).finally(()=>{this.isLoading=!1})}},mounted(){this.getOrders()}},Lt=t("h1",{class:"mt-3"},"訂單頁面",-1),Et={class:"container"},Ct={class:"mt-4"},Vt={class:"table align-middle"},It=t("thead",null,[t("tr",null,[t("th",null,"購買日期"),t("th",null,"訂購人"),t("th",null,"購買品項(數量/單位)"),t("th",{class:"text-start"},"應付金額"),t("th",{class:"text-start"},"付款與否"),t("th",null,"編輯")])],-1),St=t("br",null,null,-1),Nt={class:"h6 text-start"},Tt={class:"text-center"},Rt={class:"form-check form-switch text-start"},Bt=["onUpdate:modelValue","onChange"],Ft={class:"form-check-label",for:"flexSwitchCheck"},jt={key:0,class:"text-success"},Ht={key:1},qt={class:"btn-group btn-group-sm"},Gt=["onClick"],zt=["onClick"];function Jt(o,a,e,m,s,p){const g=_("fairy-loading"),d=_("VueLoading"),f=_("orders-modal"),P=_("del-modal"),D=_("alert-messages"),U=_("pagination-btn");return i(),r(u,null,[Lt,h(d,{active:s.isLoading},{default:C(()=>[h(g)]),_:1},8,["active"]),t("div",Et,[t("div",Ct,[h(f,{ref:"OrdersModal",onGet_data:p.getOrders},null,8,["onGet_data"]),h(P,{ref:"DelModal",onDelorder:p.Delete_order},null,8,["onDelorder"]),h(D,{ref:"AlertMessages"},null,512),t("table",Vt,[It,t("tbody",null,[s.orders?(i(!0),r(u,{key:0},w(s.orders,n=>(i(),r("tr",{key:n.id},[t("td",null,l(new Date(n.create_at*1e3).toLocaleDateString()),1),t("td",null,l(n.user.name),1),t("td",null,[(i(!0),r(u,null,w(n.products,(c,L)=>(i(),r("div",{key:L},[V(l(c.product.title)+" 數量："+l(c.qty)+l(c.product.unit),1),St]))),128))]),t("td",Nt,l(n.total),1),t("td",Tt,[t("div",Rt,[x(t("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"flexSwitchCheck","onUpdate:modelValue":c=>n.is_paid=c,onChange:c=>p.Paid_Stutas(n)},null,40,Bt),[[v,n.is_paid]]),t("label",Ft,[n.is_paid?(i(),r("div",jt,"完成付款")):(i(),r("div",Ht,"尚未付款"))])])]),t("td",null,[t("div",qt,[t("button",{type:"button",class:"btn btn-outline-primary",onClick:c=>this.$refs.OrdersModal.show_Modal("edit",n)}," 檢視 ",8,Gt),t("button",{type:"button",class:"btn btn-outline-danger",onClick:c=>this.$refs.DelModal.show_Modal("order",n)}," 刪除 ",8,zt)])])]))),128)):$("",!0)])])]),h(U,{pagination:s.pagination,onChange_page:p.getOrders},null,8,["pagination","onChange_page"])])],64)}const Zt=A(Ut,[["render",Jt]]);export{Zt as default};
