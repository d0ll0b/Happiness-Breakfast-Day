import{F as A}from"./FairyLoading-BmbdhaJQ.js";import{A as w}from"./AlertMessages-JIZeSrfZ.js";import{_ as V,m as L,a as k,c as n,d as g,w as M,b as t,F as y,s as P,f as c,t as _,y as T,r as b,o as l,e as v,v as C,x as E}from"./index-FcHiHiKZ.js";import{c as x}from"./cartStore-miyaYOZU.js";var N={VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2",VITE_APP_API_NAME:"dollob_api",BASE_URL:"/Happiness-Breakfast-Day/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:h,VITE_APP_API_NAME:p}=N,B={data(){return{total:"",finalTotal:"",isLoading:!1,form:{user:{name:"",email:"",tel:"",address:""},message:""}}},components:{FairyLoading:A,AlertMessages:w},computed:{...L(x,["carts"])},methods:{add_cart(o,e=1,i){let r="",a="";const u=`加入購物車成功，新增${e}筆商品~~`;this.isLoading=!0,i==="new"?(r=`${h}/api/${p}/cart`,a="post"):(r=`${h}/api/${p}/cart/${i}`,a="put");const m={product_id:o,qty:e};this.axios[a](r,{data:m}).then(d=>{this.get_cart(),this.$refs.AlertMessages.show_toast(u)}).catch(d=>{this.$refs.AlertMessages.show_alert(d==null?void 0:d.response.data.message,1300,"error")}).finally(()=>{this.isLoading=!1})},delete_cart(o=null){let e="",i="",r="";this.isLoading=!0,o===null?(r=confirm("是否清空購物車？"),e=`${h}/api/${p}/carts`,i="購物車已清空 ಥ_ಥ"):(r=confirm("是否刪除品項？"),e=`${h}/api/${p}/cart/${o}`,i="已從購物車刪除 ಥ_ಥ"),r&&this.axios.delete(e).then(a=>{this.get_cart(),this.$refs.AlertMessages.show_toast(i)}).catch(a=>{this.$refs.AlertMessages.show_alert(a==null?void 0:a.response.data.message,1300,"error")}).finally(()=>{this.isLoading=!1})},onSubmit(){const o=`${h}/api/${p}/order`;this.isLoading=!0,this.axios.post(o,{data:this.form}).then(e=>{this.get_cart(),this.$refs.form.resetForm(),this.form.message="",this.$refs.AlertMessages.show_toast("訂單已成交，謝謝~~")}).catch(e=>{this.$refs.AlertMessages.show_alert(e==null?void 0:e.response.data.message,1300,"error")}).finally(()=>{this.isLoading=!1})},...k(x,["get_cart"])},mounted(){this.get_cart()}},I={class:"container"},U={class:"d-flex row"},S=t("div",{class:"d-flex mt-4 justify-content-start"},[t("div",null,[t("h2",null,"購物車")])],-1),D={class:"table align-middle border-primary border-top border-start border-end mt-4"},z=t("thead",{class:"table-primary"},[t("tr",null,[t("th",{class:"text-start w-30"},"商品"),t("th",null,"單價"),t("th",{style:{width:"150px"}},"數量"),t("th",{class:"text-end"},"小計"),t("th")])],-1),F={class:"text-start"},R=["src","alt"],H={key:0,class:"text-success"},j={key:0,class:"text-success"},q={class:"input-group input-group-sm"},O={class:"input-group"},G=["onUpdate:modelValue","disabled","onBlur"],J={class:"input-group-text",id:"basic-addon2"},K={class:"text-end"},Q={key:0,class:"text-success"},W=["onClick"],X={key:0,class:"fas fa-spinner fa-pulse"},Y=t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-trash",viewBox:"0 0 16 16"},[t("path",{d:"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"}),t("path",{d:"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"})],-1),Z={class:"table-primary"},tt=t("td",{colspan:"4",class:"text-end"},"總計",-1),st={colspan:"3",class:"text-center"},et={key:0},at=t("td",{colspan:"4",class:"text-end text-success"},"折扣價",-1),ot={colspan:"3",class:"text-center text-success"},nt={class:"text-end mb-4 d-flex justify-content-between"};function lt(o,e,i,r,a,u){const m=b("fairy-loading"),d=b("VueLoading"),$=b("alert-messages");return l(),n(y,null,[g(d,{active:a.isLoading},{default:M(()=>[g(m)]),_:1},8,["active"]),g($,{class:"top-50",ref:"AlertMessages"},null,512),t("div",I,[t("div",U,[S,t("table",D,[z,t("tbody",null,[o.carts?(l(!0),n(y,{key:0},P(o.carts,s=>(l(),n("tr",{key:s.id},[t("td",F,[t("img",{class:"me-3 product_img",src:s.product.imageUrl,alt:s.product.title},null,8,R),v(" "+_(s.product.title)+" ",1),s.coupon?(l(),n("div",H," 已套用優惠券 ")):c("",!0)]),t("td",null,[s.coupon?(l(),n("small",j,"折扣價：")):c("",!0),v(" NT$"+_(s.product.price),1)]),t("td",null,[t("div",q,[t("div",O,[C(t("input",{min:"1",type:"number",class:"form-control","onUpdate:modelValue":f=>s.qty=f,disabled:a.isLoading,onBlur:f=>u.add_cart(s.product_id,s.qty,s.id)},null,40,G),[[E,s.qty,void 0,{number:!0}]]),t("span",J,_(s.product.unit),1)])])]),t("td",K,[s.coupon?(l(),n("small",Q,"折扣價：")):c("",!0),v(" NT$"+_(s.product.price),1)]),t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:f=>u.delete_cart(s.id)},[a.isLoading?(l(),n("i",X)):c("",!0),Y],8,W)])]))),128)):c("",!0)]),t("tfoot",Z,[t("tr",null,[tt,t("td",st,"NT$ "+_(a.total),1)]),o.carts.total!==o.carts.finalTotal?(l(),n("tr",et,[at,t("td",ot,"NT$"+_(a.finalTotal),1)])):c("",!0)])]),t("div",nt,[t("div",null,[o.carts.length?(l(),n("button",{key:0,class:"btn btn-outline-danger",type:"button",onClick:e[0]||(e[0]=s=>u.delete_cart())},"清空購物車")):c("",!0)]),t("div",null,[t("button",{class:T(["btn btn-primary text-white",{disabled:!o.carts.length}]),type:"button",onClick:e[1]||(e[1]=s=>this.$router.push("/checkout"))},"前往結帳",2)])])])])],64)}const _t=V(B,[["render",lt]]);export{_t as default};
