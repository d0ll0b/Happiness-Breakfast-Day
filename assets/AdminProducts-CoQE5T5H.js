import{A as $}from"./AlertMessages-JIZeSrfZ.js";import{M as E,D as C,P as N}from"./PaginationBtn-ZN-4jYWm.js";import{_ as k,o as a,c as n,b as t,d as h,t as g,v as r,x as p,F as x,s as D,f,e as b,C as T,r as _,w as R}from"./index-FcHiHiKZ.js";import{F as S}from"./FairyLoading-BmbdhaJQ.js";var B={VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2",VITE_APP_API_NAME:"dollob_api",BASE_URL:"/Happiness-Breakfast-Day/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:M,VITE_APP_API_NAME:y}=B,F={props:["product"],data(){return{products:[],tempProduct:{},isNew:!1,title:"",ProductsModal:"",isLoading:!1}},components:{AlertMessages:$},mounted(){this.ProductsModal=new E(this.$refs.productModal,{keyboard:!1});const l=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.axios.defaults.headers.common.Authorization=l,this.tempProduct={...this.product}},methods:{getData(){this.$emit("get_data")},show_Modal(l,s){switch(l){case"new":this.isNew=!0,this.tempProduct={imagesUrl:[]},this.ProductsModal.show();break;case"edit":this.isNew=!1,this.tempProduct={...s},this.ProductsModal.show();break}},Update_product(l){let s="";this.isNew===!0?(s=`${M}/api/${y}/admin/product`,this.axios.post(s,{data:this.tempProduct}).then(o=>{this.$refs.AlertMessages.show_toast("新增產品成功!!!"),this.getData(),this.ProductsModal.hide()}).catch(o=>{this.$refs.AlertMessages.show_alert(o==null?void 0:o.response.data.message,1300,"error")})):(s=`${M}/api/${y}/admin/product/${l}`,this.axios.put(s,{data:this.tempProduct}).then(o=>{this.$refs.AlertMessages.show_toast("更新產品成功!!!"),this.getData(),this.ProductsModal.hide()}).catch(o=>{this.$refs.AlertMessages.show_alert(o==null?void 0:o.response.data.message,1300,"error")}))},ShowImagebtn(l){return!Object.prototype.hasOwnProperty.call(l,"imagesUrl")&&!Array.isArray(l.imagesUrl)&&(l.imagesUrl=[],l.imagesUrl.push("")),!0},UploadImg(){let l="";l=`${M}/api/${y}/admin/upload`,this.isLoading=!0;const s=new FormData;s.append("file-to-upload",this.$refs.fileinput.files[0]),this.axios.post(l,s,{headers:{"Content-Type":"multipart/form-data"}}).then(o=>{this.tempProduct.imageUrl===""||this.tempProduct.imageUrl===void 0?this.tempProduct.imageUrl=o.data.imageUrl:this.tempProduct.imagesUrl[this.tempProduct.imagesUrl.length-1]===""?this.tempProduct.imagesUrl[this.tempProduct.imagesUrl.length-1]=o.data.imageUrl:this.tempProduct.imagesUrl.push(o.data.imageUrl),this.$refs.fileinput.value="",this.$refs.AlertMessages.show_toast("圖片上傳成功!!!")}).catch(o=>{this.$refs.AlertMessages.show_alert(o==null?void 0:o.response.data.message,1300,"error")}).finally(()=>{this.isLoading=!1})}}},O={id:"productModal",ref:"productModal",class:"modal fade text-start",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},z={class:"modal-dialog modal-xl"},G={class:"modal-content border-0"},H={class:"modal-header bg-dark text-white"},j={id:"productModalLabel",class:"modal-title"},q=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),J={class:"modal-body"},K={class:"row"},Q={class:"col-sm-4"},W={class:"mb-2"},X={class:"mb-3"},Y=t("label",{for:"imageUrl",class:"form-label text-success h5 font-weight-bold"},"主圖",-1),Z=["for"],tt=["id","onUpdate:modelValue"],st=["src"],et={key:0},ot={class:"mb-3"},it={for:"formFile",class:"form-label"},lt={key:0,class:"fas fa-spinner fa-pulse"},at=["disabled"],nt={class:"col-sm-8"},dt={class:"mb-3"},rt=t("label",{for:"title",class:"form-label"},"標題",-1),ct={class:"row"},pt={class:"mb-3 col-md-6"},ut=t("label",{for:"category",class:"form-label"},"分類",-1),mt={class:"mb-3 col-md-6"},ht=t("label",{for:"unit",class:"form-label"},"單位",-1),_t={class:"row"},gt={class:"mb-3 col-md-6"},ft=t("label",{for:"origin_price",class:"form-label"},"原價",-1),bt={class:"mb-3 col-md-6"},Pt=t("label",{for:"price",class:"form-label"},"售價",-1),Ut=t("hr",null,null,-1),vt={class:"mb-3"},wt=t("label",{for:"description",class:"form-label"},"產品描述",-1),Mt={class:"mb-3"},yt=t("label",{for:"content",class:"form-label"},"說明內容",-1),At={class:"mb-3"},xt={class:"form-check"},$t=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),kt={class:"modal-footer"},Dt=t("button",{type:"button",class:"btn btn-outline-danger","data-bs-dismiss":"modal"}," 取消 ",-1);function Vt(l,s,o,d,e,u){const v=_("alert-messages");return a(),n("div",O,[t("div",z,[t("div",G,[h(v,{ref:"AlertMessages"},null,512),t("div",H,[t("h5",j,[t("span",null,g(e.title)+"產品",1)]),q]),t("div",J,[t("div",K,[t("div",Q,[t("div",W,[t("div",X,[Y,r(t("input",{type:"text",class:"form-control",id:"imageUrl",placeholder:"請輸入圖片連結","onUpdate:modelValue":s[0]||(s[0]=i=>e.tempProduct.imageUrl=i)},null,512),[[p,e.tempProduct.imageUrl]])]),(a(!0),n(x,null,D(e.tempProduct.imagesUrl,(i,m)=>(a(),n("div",{class:"mb-3",key:m},[t("label",{for:"imagesUrl_"+m,class:"form-label"},"附圖"+g(m+1),9,Z),r(t("input",{type:"text",class:"form-control",id:"imagesUrl_"+m,placeholder:"請輸入圖片連結","onUpdate:modelValue":w=>e.tempProduct.imagesUrl[m]=w},null,8,tt),[[p,e.tempProduct.imagesUrl[m]]])]))),128)),t("img",{class:"img-fluid",src:e.tempProduct.imageUrl,alt:""},null,8,st)]),u.ShowImagebtn(e.tempProduct)?(a(),n("div",et,[t("div",ot,[t("label",it,[e.isLoading?(a(),n("i",lt)):f("",!0),b(" 上傳圖片 ")]),t("input",{class:"form-control",type:"file",id:"formFile",ref:"fileinput",onChange:s[1]||(s[1]=(...i)=>u.UploadImg&&u.UploadImg(...i)),disabled:e.isLoading},null,40,at)]),e.tempProduct.imagesUrl.length<5?(a(),n("button",{key:0,class:"btn btn-outline-primary btn-sm d-block w-100",onClick:s[2]||(s[2]=i=>{this.tempProduct.imagesUrl.push("")})}," 新增附圖 ")):f("",!0),e.tempProduct.imagesUrl.length>0?(a(),n("button",{key:1,class:"btn btn-outline-danger btn-sm d-block w-100",onClick:s[3]||(s[3]=i=>{this.tempProduct.imagesUrl.splice(-1,1)})}," 刪除附圖 ")):f("",!0)])):f("",!0)]),t("div",nt,[t("div",dt,[rt,r(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":s[4]||(s[4]=i=>e.tempProduct.title=i)},null,512),[[p,e.tempProduct.title]])]),t("div",ct,[t("div",pt,[ut,r(t("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入分類","onUpdate:modelValue":s[5]||(s[5]=i=>e.tempProduct.category=i)},null,512),[[p,e.tempProduct.category]])]),t("div",mt,[ht,r(t("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":s[6]||(s[6]=i=>e.tempProduct.unit=i)},null,512),[[p,e.tempProduct.unit]])])]),t("div",_t,[t("div",gt,[ft,r(t("input",{id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":s[7]||(s[7]=i=>e.tempProduct.origin_price=i)},null,512),[[p,e.tempProduct.origin_price,void 0,{number:!0}]])]),t("div",bt,[Pt,r(t("input",{id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":s[8]||(s[8]=i=>e.tempProduct.price=i)},null,512),[[p,e.tempProduct.price,void 0,{number:!0}]])])]),Ut,t("div",vt,[wt,r(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":s[9]||(s[9]=i=>e.tempProduct.description=i)},`
                  `,512),[[p,e.tempProduct.description]])]),t("div",Mt,[yt,r(t("textarea",{id:"content",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":s[10]||(s[10]=i=>e.tempProduct.content=i)},`
                  `,512),[[p,e.tempProduct.content]])]),t("div",At,[t("div",xt,[r(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":s[11]||(s[11]=i=>e.tempProduct.is_enabled=i)},null,512),[[T,e.tempProduct.is_enabled]]),$t])])])])]),t("div",kt,[Dt,t("button",{type:"button",class:"btn btn-primary",onClick:s[12]||(s[12]=i=>u.Update_product(e.tempProduct.id))}," 確認 ")])])])],512)}const A=k(F,[["render",Vt]]);var Lt={VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2",VITE_APP_API_NAME:"dollob_api",BASE_URL:"/Happiness-Breakfast-Day/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API_URL:P,VITE_APP_API_NAME:U}=Lt,It={data(){return{products:[],product:{imagesUrl:[]},isNew:!1,pagination:{},isLoading:!1}},components:{ProductsModal:A,DelModal:C,AlertMessages:$,PaginationBtn:N,FairyLoading:S},methods:{getData(l=1){this.isLoading=!0;const s=`${P}/api/${U}/admin/products?page=${l}`;this.axios.get(s).then(o=>{const{products:d,pagination:e}=o.data;this.products=d,this.pagination=e}).catch(o=>{this.$refs.AlertMessages.show_alert(o==null?void 0:o.response.data.message,1300,"error")}).finally(()=>{this.isLoading=!1})},Update_product(l,s){let o="";s===!0?(o=`${P}/api/${U}/admin/product`,this.axios.post(o,{data:this.tempProduct}).then(d=>{this.$refs.AlertMessages.show_toast("新增產品成功!!!"),this.getData(),A.hide()}).catch(d=>{this.$refs.AlertMessages.show_alert(d==null?void 0:d.response.data.message,1300,"error")})):(o=`${P}/api/${U}/admin/product/${l}`,this.axios.put(o,{data:this.tempProduct}).then(d=>{this.$refs.AlertMessages.show_toast("更新產品成功!!!"),this.getData(),A.hide()}).catch(d=>{this.$refs.AlertMessages.show_alert(d==null?void 0:d.response.data.message,1300,"error")}))},Delete_product(l){let s="";s=`${P}/api/${U}/admin/product/${l}`,this.axios.delete(s).then(o=>{this.$refs.AlertMessages.show_toast("刪除產品完成!!!"),this.getData(),this.$refs.DelModal.hide_Modal()}).catch(o=>{this.$refs.AlertMessages.show_alert(o==null?void 0:o.response.data.message,1300,"error")})}},mounted(){const l=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.axios.defaults.headers.common.Authorization=l,this.getData()}},Et=t("h1",{class:"mt-3"},"產品頁面",-1),Ct={class:"container"},Nt={class:"row py-3"},Tt={class:"text-end"},Rt={class:"table table-hover mt-4"},St=t("thead",null,[t("tr",null,[t("th",{width:"120"}," 分類 "),t("th",null,"產品名稱"),t("th",{width:"120"}," 原價 "),t("th",{width:"120"}," 售價 "),t("th",{width:"150"}," 是否啟用 "),t("th",{width:"120"}," 編輯 ")])],-1),Bt={width:"120"},Ft={width:"150"},Ot={class:"h5 font-weight-bold text-warning"},zt={width:"120"},Gt={width:"120"},Ht={width:"150"},jt={key:0,class:"text-success"},qt={key:1},Jt={class:"btn-group btn-group-sm"},Kt=["onClick"],Qt={key:0,class:"fas fa-spinner fa-pulse"},Wt=["onClick"],Xt={key:0,class:"fas fa-spinner fa-pulse"};function Yt(l,s,o,d,e,u){const v=_("fairy-loading"),i=_("VueLoading"),m=_("products-modal"),w=_("del-modal"),V=_("alert-messages"),L=_("pagination-btn");return a(),n(x,null,[Et,h(i,{active:e.isLoading},{default:R(()=>[h(v)]),_:1},8,["active"]),t("div",Ct,[t("div",Nt,[h(m,{ref:"ProductsModal",product:e.product,onGet_data:u.getData},null,8,["product","onGet_data"]),h(w,{ref:"DelModal",temp:e.product,onDelproduct:u.Delete_product},null,8,["temp","onDelproduct"]),h(V,{ref:"AlertMessages"},null,512),t("div",Tt,[t("button",{class:"btn btn-primary h3",type:"button",onClick:s[0]||(s[0]=c=>this.$refs.ProductsModal.show_Modal("new"))},"新增產品")]),t("table",Rt,[St,t("tbody",null,[(a(!0),n(x,null,D(e.products,c=>(a(),n("tr",{key:c.id},[t("td",Bt,g(c.category),1),t("td",Ft,[t("span",Ot,g(c.title),1)]),t("td",zt,g(c.origin_price),1),t("td",Gt,g(c.price),1),t("td",Ht,[c.is_enabled?(a(),n("span",jt,"啟用")):(a(),n("span",qt,"未啟用"))]),t("td",null,[t("div",Jt,[t("button",{type:"button",class:"btn btn-outline-primary",onClick:I=>this.$refs.ProductsModal.show_Modal("edit",c)},[e.isLoading?(a(),n("i",Qt)):f("",!0),b(" 修改 ")],8,Kt),t("button",{type:"button",class:"btn btn-outline-danger",onClick:I=>this.$refs.DelModal.show_Modal("product",c)},[e.isLoading?(a(),n("i",Xt)):f("",!0),b(" 刪除 ")],8,Wt)])])]))),128))])]),t("p",null,[b("目前有 "),t("span",null,g(e.products.length),1),b(" 項產品")])]),h(L,{pagination:e.pagination,onChange_page:u.getData},null,8,["pagination","onChange_page"])])],64)}const os=k(It,[["render",Yt]]);export{os as default};
